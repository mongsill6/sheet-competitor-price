# 💰 sheet-competitor-price

경쟁사 가격을 자동으로 크롤링하여 Google 스프레드시트에 기록하는 Apps Script 프로젝트입니다.

## ✨ 주요 기능

- **자동 가격 수집**: 설정한 URL에서 정규식/XPath로 가격 추출
- **변동률 추적**: 이전 수집 대비 변동률 자동 계산
- **이메일 알림**: 설정 임계값 이상 변동 시 즉시 알림
- **히스토리 관리**: 오래된 데이터 자동 정리
- **커스텀 메뉴**: 스프레드시트 UI에서 바로 실행

## 🚀 설치법

### 1단계: 스프레드시트 생성
1. [Google Sheets](https://sheets.google.com)에서 새 스프레드시트 생성
2. **확장 프로그램 → Apps Script** 클릭

### 2단계: 코드 복사
1. 기본 `Code.gs`의 내용을 삭제하고 이 프로젝트의 `Code.gs` 내용을 붙여넣기
2. **파일 → 새 스크립트 파일** → `Config` 입력 → `Config.gs` 내용 붙여넣기

### 3단계: 설정
`Config.gs`에서 모니터링할 URL과 가격 추출 패턴을 설정합니다:

```javascript
TARGETS: [
  {
    name: '경쟁사A - 상품명',
    url: 'https://shopping.example.com/product/123',
    method: 'regex',
    pattern: '([0-9,]+)\\s*원',
    xpath: '',
  },
],
```

### 4단계: 실행
1. 스프레드시트를 새로고침하면 **💰 가격 모니터링** 메뉴가 나타납니다
2. **지금 수집** 클릭 → 첫 실행 시 권한 승인 필요
3. **자동실행 시작** 클릭 → 설정된 간격으로 자동 수집

## ⚙️ 설정 항목

| 항목 | 설명 | 기본값 |
|------|------|--------|
| `SPREADSHEET_ID` | 시트 ID (비워두면 바인딩된 시트) | `''` |
| `SHEET_NAME` | 데이터 기록 시트 이름 | `가격모니터링` |
| `ALERT_ENABLED` | 이메일 알림 활성화 | `true` |
| `ALERT_THRESHOLD_PERCENT` | 알림 발송 변동률(%) | `5` |
| `RUN_INTERVAL_MINUTES` | 자동 수집 간격(분) | `60` |
| `REQUEST_DELAY_MS` | 요청 간 대기(ms) | `2000` |
| `MAX_HISTORY_DAYS` | 데이터 보관 일수 | `90` |

## 🔍 가격 추출 방법

### regex (권장)
HTML 소스에서 정규식으로 가격을 추출합니다. 첫 번째 캡처 그룹이 가격으로 사용됩니다.

```javascript
// 일반적인 "12,900원" 패턴
pattern: '([0-9,]+)\\s*원'

// JSON 내 price 필드
pattern: '"price":\\s*([0-9,]+)'

// data-price 속성
pattern: 'data-price="([0-9,]+)"'
```

### xpath
Google Sheets의 `IMPORTXML` 함수를 활용합니다. 서버 사이드 렌더링 페이지에서 유용합니다.

```javascript
method: 'xpath',
xpath: '//span[@class="price"]/text()'
```

## 🛒 이커머스 활용 예시

### 쿠팡 경쟁 셀러 가격 모니터링
```javascript
TARGETS: [
  {
    name: '경쟁사A - 무선이어폰',
    url: 'https://www.coupang.com/vp/products/123456',
    method: 'regex',
    pattern: 'class="total-price">.*?<strong>([0-9,]+)',
  },
]
```

### 네이버 쇼핑 최저가 추적
```javascript
TARGETS: [
  {
    name: '키보드 - 네이버최저가',
    url: 'https://search.shopping.naver.com/catalog/123456',
    method: 'regex',
    pattern: '"minPrice":"([0-9,]+)"',
  },
]
```

### 이커머스 활용 시나리오

1. **가격 경쟁력 분석**: 내 상품과 경쟁사 상품 가격을 일별로 추적하여 가격 전략 수립
2. **프로모션 감지**: 경쟁사가 할인을 시작하면 즉시 알림 → 빠른 대응
3. **시장 가격 트렌드**: 특정 카테고리 대표 상품들의 가격 추이를 파악
4. **원가 변동 대응**: 원자재/공급가 변동에 따른 시장 가격 변화 모니터링
5. **마진 관리**: 경쟁사 가격 대비 내 마진율 자동 계산 (시트 수식 활용)

### 활용 팁
- **수집 주기**: 이커머스는 1~2시간 간격 권장 (너무 빈번하면 차단 위험)
- **User-Agent**: 기본 내장되어 있으나, 차단 시 Config에서 변경 가능
- **프록시**: Apps Script는 Google IP로 요청하므로 대부분의 사이트에서 접근 가능
- **가격 패턴**: 사이트마다 HTML 구조가 다르므로, 개발자 도구(F12)에서 소스를 확인하여 패턴 작성

## 📋 실행 결과 예시

| 수집일시 | 경쟁사A (가격) | 경쟁사A (변동률) | 경쟁사B (가격) | 경쟁사B (변동률) | 비고 |
|----------|---------------|-----------------|---------------|-----------------|------|
| 2026-02-17 14:00:00 | 29,900 | - | 31,500 | - | |
| 2026-02-17 15:00:00 | 27,900 | -6.7% | 31,500 | 0.0% | |
| 2026-02-17 16:00:00 | 27,900 | 0.0% | 29,900 | -5.1% | |

## ⚠️ 주의사항

- 일부 사이트는 JavaScript로 가격을 렌더링하여 `UrlFetchApp`으로 가져올 수 없습니다
- 과도한 요청은 IP 차단의 원인이 됩니다. `REQUEST_DELAY_MS`를 적절히 설정하세요
- Apps Script 일일 실행 한도: 일반 계정 90분, Workspace 계정 6시간

## 📄 라이선스

MIT License
